<div class="top-show-challenge">
  <div class="mx-3">
    <div class="col-12 d-flex">
      <div class="container">

          <%# CAS: challenge terminÃ© // DONE %>
          <% if @challenge.started %>
            <% if @challenge.end_date < Date.today %>
              <div class='challenge-description my-4 d-flex flex-column align-items-center'>
                <div class="mt-5 mb-2">
                  <h2 class="card-blue">"<%= @challenge.title %>" est inactif</h2>
                </div>
              </div>
                <div>
                  <h6 class="pb-3">TerminÃ© depuis le <%= @challenge.end_date %>,<br>DurÃ©e totale : <%= @challenge.total_time %> jours.</h6>
                  <div class="card3 text-center my-4">
                    <p>ðŸŽ‰ Tu as effectuÃ© <%= @progression_count_current_user %> jours de challenge, et remportÃ© <%= @total_points_count %> points! ðŸŽ‰</p>
                  </div>
                <p class="my-4"><em>Nostalgique ? Tu peux toujours recrÃ©er ce challenge, ou en inventer un autre <%= link_to "ici", new_challenge_path %>!<em></p>
                </div>

            <%# CAS: challenge lancÃ©, en cours %>
            <% else %>
              <div class='challenge-description my-5 d-flex flex-column align-items-center'>
                <div class="mt-5 mb-2">
                  <h1 class="card-blue">"<%= @challenge.title.capitalize %>" est lancÃ©!</h1>
                </div>
                <div class="card-under-blue my-5">
                  <p>Wouhou! Tu participes actuellement Ã  ce challenge ðŸš€</p>
                  <p class="text-center my-4"><strong>Date de fin:</strong> <em><%= @challenge.end_date %></em>,
                  <br>Il te reste <%= @time_left %> jours pour te surpasser!</p>
                </div>
                <p class="blockquote mt-2">"<%= @challenge.description %>"</p>
                <figcaption class="blockquote-footer text-right"><%= @creator.name %></figcaption>
                <div class="card3 text-center my-4">
                  <h5>Tous les participantÂ·eÂ·s</h5>
                  <ul class="text-left">
                    <% @users.each do |user| %>
                      <li><%= cl_image_tag user.photo.key, id:"avatar" %></li>
                      <li><small><%= user.name.capitalize %></small></li>
                      <li>
                        <% @participations.each do |participation| %>
                          <% if participation.user_id == user.id %>
                            <% @progression_count = 0 %>

                            <% participation.progressions.each do |progression| %>
                              <% if progression.done %>
                                <% @progression_count += progression.points %>
                              <% end %>
                            <% end %>
                          <% end %>
                        <% end %>
                      </li>
                    <% end %>
                  </ul>
                </div>
                <div class="card3">
                  <h5>Progressions</h5>
                  <div class="card-not-center my-4">
                    <ul>
                      <% @participations.each do |participation| %>
                          <% @progression_count = 0 %>
                          <% participation.progressions.each do |progression| %>
                            <% if progression.done %>
                              <% @progression_count += 1 %>
                            <% end %>
                          <% end %>
                        <div>
                          <% ratio = @progression_count*100/@challenge.total_time%>
                          <small class="mb-0 text-left"><%= participation.user.name %>: <%= @progression_count %> jours</small>
                          <%= image_tag "#{ratio.round(-1)}.svg", class:"mb-3" %><br>
                        </div>
                      <% end %>
                    </ul>
                  </div>
                </div>
              </div>
            <% end %>

          <%# CAS: challenge prÃªt Ã  Ãªtre lancÃ©, invitation amis ! FIXER le bouton accueil %>
          <% else %>
          <div class='challenge-description my-5 d-flex flex-column align-items-center'>
            <div class="mt-5 mb-2">
                <h2 id="title", class="card-blue" data-challenge="<%= @challenge.title %>">
                  "<%= @challenge.title %>" est prÃªt Ã  Ãªtre lancÃ©!
                </h2>
            </div>
              <div class="card-not-center mt-4">
                <p
                  id="debut"
                  data-challenge-debut="<%= @challenge.total_time %>"
                  data-challenge-time-left="<%= @time_left %>">
                  DÃ©but: <em><%= @challenge.start_date %></em>,<br><strong>DurÃ©e:</strong> <%= @challenge.total_time %> jours.
                </p>
              </div>
                <% if current_user == @creator %>
                  <p>"<%= @challenge.description %>"</p>
                  <figcaption class="blockquote-footer text-right"><%= @creator.name %></figcaption>

                  <div class="card3 text-center my-4"
                    data-controller="share"
                    data-share-id-value= <%= @challenge.id %>
                    data-share-title-value= <%= @challenge.title %>
                    data-share-creator-value= <%= @creator.name %>>
                      <p class="pb-3">T'es prÃªt Ã  rÃ©colter des points et dÃ©fier tes potes?</p>
                      <p class= "btn btn-primary" data-action="click->share#shareLink"> Partage ton lien! </p>
                  </div>
              <% else %>
                <div class="card3 text-center my-4">
                  <div data-controller='enter-challenge'
                    data-enter-challenge-target="cardEnter"
                    data-enter-challenge-create-url-value= "<%= participations_path %>"
                    data-enter-challenge-user-id-value= "<%= current_user.id %>"
                    data-enter-challenge-challenge-id-value= "<%= @challenge.id %>">

                    <%# CAS: invitation reÃ§ue au challenge %>
                    <p data-enter-challenge-target="canard">Veux-tu y participer?</p>
                    <button data-enter-challenge-target="poule" class="btn btn-go btn-primary" data-action="click->enter-challenge#accept">
                      Let's go!
                    </button>
                    <button data-enter-challenge-target="oie" class="btn btn-nop btn-primary" data-action="click->enter-challenge#refuse">
                      Nope
                    </button>
                  </div>
                </div>
              <% end %>
            <div class="card3 my-3">
              <h5>ParticipantÂ·eÂ·s inscrits:</h5>
              <p class="pb-2"><em>Tout le monde est la? Lance le challenge!</em></p>
              <% @users.each do |user| %>
                <ul class="text-left in-line">
                  <li><%= cl_image_tag user.photo.key, height: 200, width: 200, crop: :fill, id:"avatar" %> <strong><%= user.name %></strong></li>
                </ul>
              <% end %>

                <%# CAS: bouton "lancer le challenge" %>
              <% if current_user == @creator %>
                <div data-controller="started"
                  data-started-update-url-value="<%=  started_challenge_path(@challenge) %>">
                  <button id="launch2" class="btn mt-2 btn-primary" data-action="click->started#status">
                    C'est parti !ðŸš€
                  </button>
                </div>
              <% end %>
            <% end %>
          </div>
      </div>
    </div>
  </div>
</div>
