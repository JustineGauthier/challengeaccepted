<%# CAS: challenge terminé // DONE %>
<% if @challenge.end_date < Date.today %>
  <div class="container">
    <div class="w-100 text-center">
      <li><%= cl_image_tag @challenge.photo.key, height: 200, width: 200, crop: :fill %></li>
      <h2>Le challenge "<%= @challenge.title %>" s'est terminé le <%= @challenge.end_date %></h1>
      <h6>Durée totale : <%= @challenge.total_time %> jours.</h6>
      <p>🎉 Tu as effectué "TODO"<%= @progression_count %> jours de challenge, et remporté "TO CHECK"<%= @new_points %> points! 🎉</p>
        <div class="w-100 text-center">
          <ul>
            <% @users.each do |user| %>
            <li> <strong><%= user.name %>:</strong> <%= @new_points %>"TO CHECK" 🏆</li>
            <li><%= cl_image_tag user.photo.key, height: 200, width: 200, crop: :fill</li>
          </ul>
        </div>
    </div>
  </div>
<% end %>

  <% elsif @challenge.start_date < Date.tomorrow && @challenge.end_date > Date.today %>
  <div class='challenge-description'>
    <h1><%= @challenge.title %></h1>
    <h6>Ton challenge se termine le <em><%= @challenge.end_date %></em>. Il te reste <%= @time_left %> jours pour te surpasser!</h6>
    <p>Jusqu'ici, tu as validé "TODO"<%= @progression_count %> jours</p>
    <p>Rappel de ta superbe description: <%= @challenge.description %></p>
    <ul>
      <% @users.each do |user| %>
        <li><%= cl_image_tag user.photo.key, height: 200, width: 200, crop: :fill</li> %>
        <li><%= user.name %>: <%= user.total_points %> points.</li>
        <% @participations.each do |participation| %>
          <% if participation.user_id == user.id %>
              <% participation.progressions.each do |progression| %>
                <% if progression.done %>
                <%# rajouter la progression %>
                <% end %>
              <% end %>
          <% end %>
        <% end %>
      <% end %>
    </ul>
  </div>
<% else %>
  <h1 id="title" data-challenge="<%= @challenge.title %>">
    Le challenge "<%= @challenge.title %>" est prêt à être lancé !
  </h1>
  <h6
    id="debut"
    data-challenge-debut="<%= @challenge.total_time %>"
    data-challenge-time-left="<%= @time_left %>">
    Ton challenge commencera le <strong><%= @challenge.start_date %></strong> et se déroulera sur <strong><%= @challenge.total_time %></strong> jours.
  </h6>
  <p><strong>Rappel des règles:</strong> <%= @challenge.description %></p>
  <%= cl_image_tag(@challenge.photo.key, width: 400, height: 300, crop: :fill) %>
  <% if current_user == @creator %>
      <p>Invite tes potes !</p>
        <div data-controller="share" data-share-id-value= <%= @challenge.id %>  data-share-title-value= <%= @challenge.title %> data-share-creator-value= <%= @creator.name %>>
          <p class= "btn btn-primary" data-action="click->share#shareLink"> Partage ton lien </p>
        </div>
  <% else %>
    <div class="enter-challenge">
      <div data-controller='enter-challenge'
        data-enter-challenge-target="card-enter"
        data-enter-challenge-create-url-value= "<%= participations_path %>"
        data-enter-challenge-user-id-value= "<%= current_user.id %>"
        data-enter-challenge-challenge-id-value= "<%= @challenge.id %>">
        <p>Veux-tu participer à ce challenge ?</p>
        <button class="btn btn-primary" data-action="click->enter-challenge#accept">
          Let's go!
        </button>
        <button class="btn btn-primary" data-action="click->enter-challenge#refuse">
          Nope
        </button>
      </div>
    </div>
  <% end %>
  <h2>Les participant·e·s au challenge :</h2>
  <p>Se termine le <em><%= @challenge.end_date %></em></p>
  <% @users.each do |user| %>
  <ul>
    <%# <li><%= cl_image_tag user.photo.key, height: 200, width: 200, crop: :fill </li>%>
    <li> <strong><%= user.name %></strong></li>
    <li><%= user.total_points %> 🏆</li>
  </ul>
  <% end %>

  <% if current_user == @creator %>
    <div data-controller="started"
      data-started-update-url-value="<%=  started_challenge_path(@challenge) %>">
      <button id="launch" class="btn btn-primary" data-action="click->started#status">
      Lancer le challenge
    </button>
  </div>
  <% end %>
<% end %>
